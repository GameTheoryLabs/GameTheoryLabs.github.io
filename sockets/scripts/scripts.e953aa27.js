"use strict";!function(){var a=angular.module("networkSandboxApp",["ngAnimate","ngResource","ngRoute","ui.bootstrap","NetworkServices","server","panels"]);a.val=0}(),function(){var a=document.createElement("script");a.type="text/javascript",a.src="https://cdn.socket.io/socket.io-1.0.0.js",document.body.appendChild(a);var b=angular.module("NetworkServices",[]);b.factory("socket",["$rootScope",function(a){var b="129.119.228.109",c="8080",d=null,e={},f={on:function(b,c){try{var f=b+Date.now();return e[f]=function(){var b=arguments;a.$apply(function(){c.apply(d,b)})},d.on(b,e[f]),f}catch(g){return null}},emit:function(b,c,e){d.emit(b,c,function(){var b=arguments;a.$apply(function(){e&&e.apply(d,b)})})},removeListener:function(a,b){try{d.removeListener(a,e[b]),e[b]=null}catch(c){}},connect:function(a,e){b=a,c=e,console.log("Connecting to "+b+":"+c),d?d.connect(b+":"+c):(d=window.io.connect(b+":"+c),f.on("clients",function(a){console.log("Client Update"),f.clients.tcp=a.tcp,f.clients.udp=a.udp,f.clients.browser=a.browser}))},close:function(){console.log("Closed connection with Server"),d.close()},clients:{tcp:0,udp:0,browser:0}};return f}])}(),function(){var a=angular.module("FSMService",[]);a.factory("fsm",[function(){var a=new b,c=function(b){var c=b,e=new d,f=function(a){e.Enter(c,a)},g=function(a){e.Exit(c,a)},h=function(a){e.Execute(c,a)};this.Transition=function(b,c){g(c),e=a.get(b),f(c),h(c)},this.SetState=function(b){e=a.get(b)},this.Update=function(a){h(a)},this.GetState=function(){return e.GetName()}},d=function(a){var b=a||"default";this.GetName=function(){return b}};d.prototype.Enter=function(){},d.prototype.Exit=function(){},d.prototype.Execute=function(){};var e=new c(this);return e.Map=b,e.State={Create:function(b){var c=new d(b);return a.put(b,c),c},Get:function(b){return a.get(b)},Set:function(a){e.SetState(a)}},e}]);var b=function(a){this.current=void 0,this.size=0,this.isLinked=!0,a===!1&&this.disableLinking(),this.from=function(a,b,c){var d=new Map(c);for(var e in a)(b||a.hasOwnProperty(e))&&d.put(e,a[e]);return d},this.noop=function(){return this},this.illegal=function(){throw new Error("can't do this with unlinked maps")},this.reverseIndexTableFrom=function(a,c){for(var d=new b(c),e=0,f=a.length;f>e;++e){var g=a[e],h=d.get(g);h?h.push(e):d.put(g,[e])}return d},this.cross=function(a,c,d,e){var f,g;a.isLinked?(f=a,g=c):c.isLinked?(f=c,g=a):b.illegal();for(var h=f.size;h--;f.next()){var i=f.key();g.contains(i)&&d.call(e,i,a.get(i),c.get(i))}return e},this.uniqueArray=function(a){for(var c=new b,d=0,e=a.length;e>d;++d)c.put(a[d]);return c.listKeys()},this._hash="object "+b._counter++};b.prototype.disableLinking=function(){return this.isLinked=!1,this.link=Map.noop,this.unlink=Map.noop,this.disableLinking=Map.noop,this.next=Map.illegal,this.key=Map.illegal,this.value=Map.illegal,this.removeAll=Map.illegal,this.each=Map.illegal,this.flip=Map.illegal,this.drop=Map.illegal,this.listKeys=Map.illegal,this.listValues=Map.illegal,this},b._counter=0,b.prototype.hash=function(a){return a&&a._hash||typeof a+" "+String(a)},b.prototype.hash.current=0,b.prototype.link=function(a){0===this.size?(a.prev=a,a.next=a,this.current=a):(a.prev=this.current.prev,a.prev.next=a,a.next=this.current,this.current.prev=a)},b.prototype.unlink=function(a){0===this.size?this.current=void 0:(a.prev.next=a.next,a.next.prev=a.prev,a===this.current&&(this.current=a.next))},b.prototype.get=function(a){var b=this[this.hash(a)];return"undefined"==typeof b?void 0:b.value},b.prototype.put=function(a,b){var c=this.hash(a);if(this.hasOwnProperty(c))this[c].value=b;else{var d={key:a,value:b};this[c]=d,this.link(d),++this.size}return this},b.prototype.remove=function(a){var b=this.hash(a);return this.hasOwnProperty(b)&&(--this.size,this.unlink(this[b]),delete this[b]),this},b.prototype.removeAll=function(){for(;this.size;)this.remove(this.key());return this},b.prototype.contains=function(a){return this.hasOwnProperty(this.hash(a))},b.prototype.isUndefined=function(a){var b=this.hash(a);return this.hasOwnProperty(b)?"undefined"==typeof this[b]:!1},b.prototype.next=function(){this.current=this.current.next},b.prototype.key=function(){return this.current.key},b.prototype.value=function(){return this.current.value},b.prototype.each=function(a,b){"undefined"==typeof b&&(b=this);for(var c=this.size;c--;this.next()){var d=a.call(b,this.key(),this.value(),c>0);"number"==typeof d&&(c+=d)}return this},b.prototype.flip=function(a){for(var b=new Map(a),c=this.size;c--;this.next()){var d=this.value(),e=b.get(d);e?e.push(this.key()):b.put(d,[this.key()])}return b},b.prototype.drop=function(a,b){"undefined"==typeof b&&(b=this);for(var c=this.size;c--;)a.call(b,this.key(),this.value())?(this.remove(this.key()),--c):this.next();return this},b.prototype.listValues=function(){for(var a=[],b=this.size;b--;this.next())a.push(this.value());return a},b.prototype.listKeys=function(){for(var a=[],b=this.size;b--;this.next())a.push(this.key());return a},b.prototype.toString=function(){function a(a,d,e){b+="    { "+c.hash(a)+" : "+d+" }"+(e?",":"")+"\n"}var b="[object Map",c=this;return this.isLinked&&this.size&&(b+="\n",this.each(a)),b+="]"}}(),function(){var a=angular.module("server",["ui.bootstrap","NetworkServices","FSMService","packetInspector","packetTab","interpolationTab"]);a.LoadStates=function(a){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var b=a.State.Create("PacketInspector");b.Enter=function(a,b){a.msg="yo",b=void 0},b.Execute=function(a,b){a.msg="yo",b=void 0},b.Exit=function(a,b){a.msg="yo",b=void 0},b.active=!1,b.messages="Packets will go here \n";var c=a.State.Create("PacketPosition");c.Enter=function(a,b){a.msg="yo",b=void 0},c.Execute=function(a,b){a.msg="yo",b=void 0},c.Exit=function(a,b){a.msg="yo",b=void 0},c.active=!1,c.position={x:0,y:0};var d=a.State.Create("Interpolation");d.Enter=function(a,b){a.msg="yo",b=void 0},d.Execute=function(a,b){a.msg="yo",b=void 0},d.Exit=function(a,b){a.msg="yo",b=void 0},d.Players=new a.Map;var e=a.State.Create("DeadReckoning");e.Enter=function(a,b){a.msg="yo",b=void 0},e.Execute=function(a,b){a.msg="yo",b=void 0},e.Exit=function(a,b){a.msg="yo",b=void 0}},a.controller("ServerCtrl",["socket","fsm","$scope",function(b,c){var d=this;d.isCollapsed=!0,d.ip="smu.gametheorylabs.com",d.port="8000",d.close=function(){b.close()},d.connect=function(){b.connect(d.ip,d.port)},a.LoadStates(c)}]),a.directive("server",function(){return{restrict:"E",templateUrl:"views/server.html",controller:"ServerCtrl",controllerAs:"server"}})}(),function(){var a=angular.module("panels",["ui.bootstrap","NetworkServices"]);a.controller("PanelsCtrl",["socket","$scope",function(a,b){this.tab=1,this.clients=a.clients,b.alerts=[],b.addAlert=function(){b.alerts.push({msg:"Another alert!"})},b.closeAlert=function(a){b.alerts.splice(a,1)}}]),a.directive("panels",function(){return{restrict:"E",templateUrl:"views/panels.html",controller:"PanelsCtrl",controllerAs:"panel"}})}(),function(){var a=angular.module("packetInspector",["ui.bootstrap","NetworkServices","FSMService"]);a.controller("InspectorCtrl",["socket","fsm","$scope",function(a,b,c){var d=this;b.Transition("PacketInspector"),this.state=b.State.Get("PacketInspector"),this.AppendMessage=function(a){this.state.messages=a+"\n"+this.state.messages},this.onMessage=function(a){var b="",c=new Date,e=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+":"+c.getMilliseconds();b=a.message.id?JSON.stringify(a.message,void 0,4):String.fromCharCode.apply(null,new Uint8Array(a.message));var f="Got "+a.type+" message at: "+e;f+="\nMessage: \n"+b+"\n",d.AppendMessage(f)},this.Activate=function(){d.state.active?(console.log("Adding Packet Inspector Event Listeners"),d.onMessage.id=a.on("message",d.onMessage),null===d.onMessage.id&&(c.$parent.alerts.push({type:"danger",msg:"You Must Connect to Server Before Activating"}),d.state.active=!1)):(console.log("Removing Packet Inspector Event Listeners"),a.removeListener("message",d.onMessage.id))}}]),a.directive("packetInspector",function(){return{restrict:"E",templateUrl:"views/inspector.html",controller:"InspectorCtrl",controllerAs:"inspector"}})}(),function(){var a=angular.module("packetTab",["ui.bootstrap","NetworkServices","FSMService"]);a.controller("PacketTabCtrl",["socket","fsm","$scope",function(a,b,c){var d=this;b.Transition("PacketPosition"),this.state=b.State.Get("PacketPosition"),this.canvas=document.getElementById("packetTabCanvas"),this.ctx=this.canvas.getContext("2d"),this.drawRect=function(a,b,c){this.state.position.x=a,this.state.position.y=b,this.ctx.fillRect(this.state.position.x,this.state.position.y,5*c,5*c)},this.onMessage=function(a){1===a.message.id&&(d.canvas.width=d.canvas.width,d.drawRect(a.message.x,a.message.y,2))},this.Activate=function(){d.state.active?(console.log("Adding PacketTab Event Listeners"),d.onMessage.id=a.on("message",d.onMessage),null===d.onMessage.id&&(c.$parent.alerts.push({type:"danger",msg:"You Must Connect to Server Before Activating"}),d.state.active=!1)):(console.log("Removing PacketTab Event Listeners"),a.removeListener("message",d.onMessage.id))},this.state.active&&this.drawRect(this.state.position.x,this.state.position.y,"black",2)}]),a.directive("packetTab",function(){return{restrict:"E",templateUrl:"views/packetTab.html",controller:"PacketTabCtrl",controllerAs:"packetTab"}})}(),function(){var a=angular.module("interpolationTab",["ui.bootstrap","NetworkServices","FSMService"]);a.controller("InterpolationTabCtrl",["socket","fsm","$scope",function(a,b,c){var d=this;b.Transition("Interpolation"),this.state=b.State.Get("Interpolation"),this.players=this.state.Players,this.canvas=document.getElementById("interpolationTabCanvas"),this.ctx=this.canvas.getContext("2d"),this.drawRect=function(a,b,c,d){this.ctx.fillStyle="rgb("+c+")",this.ctx.fillRect(a,b,5*d,5*d)},this.Update=function(){if(d.state.active&&c.$parent&&3===c.$parent.panel.tab){window.requestAnimationFrame(d.Update);var a=Date.now(),b=[];d.canvas.width=d.canvas.width;for(var e=d.players.size;e>0;e--){var f=d.players.value();if(a-f.time<5e3){var g=f.x-f.currentX,h=f.y-f.currentY;g>0?f.currentX+=1:0>g&&(f.currentX-=1),h>0&&(f.currentY+=1),d.drawRect(f.currentX,f.currentY,f.id,2)}else b.push(f);d.players.next()}for(var i=b.length-1;i>=0;i--)d.players.remove(b[i].id)}},this.onMessage=function(a){if(2===a.message.id){var b=d.players.get(a.message.playerID);b||(b={},b.id=a.message.playerID,b.r=a.message.r,b.g=a.message.g,b.b=a.message.b,b.currentX=a.message.x,b.currentY=a.message.y,d.players.put(b.id,b)),b.x=a.message.x,b.y=a.message.y,b.time=Date.now()}},this.Activate=function(){d.state.active?(console.log("Adding Interpolation Tab Event Listeners"),d.onMessage.id=a.on("message",d.onMessage),null===d.onMessage.id?(c.$parent.alerts.push({type:"danger",msg:"You Must Connect to Server Before Activating"}),d.state.active=!1):d.Update()):(console.log("Removing Interpolation Tab Event Listeners"),a.removeListener("message",d.onMessage.id))},this.state.active&&this.Update()}]),a.directive("interpolationTab",function(){return{restrict:"E",templateUrl:"views/interpolationTab.html",controller:"InterpolationTabCtrl",controllerAs:"interpolationTab"}})}(),angular.module("networkSandboxApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("networkSandboxApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);